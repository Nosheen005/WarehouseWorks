version: 2

models:
  - name: fct_job_ads
    description: "Fact table of job advertisements, linking each posting to occupations, employers, job details, and related attributes."
    columns:
      - name: occupation_id
      description: "Reference to the occupation classification of the job ad."
        tests:
          - relationships:
              to: ref('dim_occupation')
              field: occupation_id
          - not_null
      - name: auxilliary_id
      description: "Reference to supplementary job attributes."
        tests: 
          - relationships:
              to: ref('dim_auxilliary_attributes')
              field: auxilliary_id 
          - not_null
      - name: employer_id
      description: "Reference to the employer posting the job."
        tests: 
          - relationships:
              to: ref('dim_employer')
              field: employer_id
          - not_null
      - name: job_details_id
      description: "Reference to detailed job specifications."
        tests: 
          - relationships:
              to: ref('dim_job_details')
              field: job_details_id
          - not_null
      - name: job_description_id
      description: "Reference to the job description text."
        tests: 
          - relationships:
              to: ref('dim_job_description')
              field: job_description_id
          - not_null
          - unique
        

      - name: relevance
      description: "Score between 0 and 1 representing the relevance of the ad."
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: vacancies
      description: "Number of open positions available in the job ad."
        tests:
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: .99
              min_value: 1
              max_value: 20
          - dbt_expectations.expect_column_max_to_be_between:
              min_value: 1
              max_value: 20
              config:
                severity: warn
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number
      - name: application_deadline
      description: "Date by which applications must be submitted."
        tests: 
          - not_null
        

  - name: dim_employer
  description: "Dimension table containing unique employers and their workplace details."
    columns:
      - name : employer_id
      description: "Surrogate key uniquely identifying an employer record."
        tests:
          - not_null
          - unique
      - name: employer_name
      description: "Official name of the employer, used as a grouping key."
        tests:
          - not_null
      - name : employer_workplace
      description: "Name of the employer’s workplace or site."
        tests:
          - not_null
      - name : workplace_street_address
      description: "Street address of the employer’s workplace."
        tests:
          - not_null
      - name : workplace_region
      description: "Region where the employer’s workplace is located."
        tests:
          - not_null
      - name : workplace_postcode
      description: "Postal code of the employer’s workplace."
        tests:
          - not_null
      - name : workplace_city
      description: "City where the employer’s workplace is located."
        tests:
          - not_null
      - name : workplace_country
      description: "Country where the employer’s workplace is located."
        tests:
          - not_null
      - name : employer_organization_number
      description: "Legal organization or registration number of the employer."
        tests:
          - not_null




  - name: dim_occupation
  description: "Dimension table containing standardized occupations, groups, and fields."
    columns:
      - name: occupation_id
        description: "Surrogate key generated from occupation."
        tests:
          - not_null
          - unique


      - name: occupation
        description: "Occupation name (grouping key)."
        tests:
          - not_null
          - unique
 
      - name: occupation_group
      description: "Broader group classification the occupation belongs to."
        tests:
          - not_null
      - name: occupation_field
      description: "Field or domain associated with the occupation."
        tests:
          - not_null

  - name: dim_auxilliary_attributes
    columns:
      - name: auxilliary_id
        tests:
          - not_null
          - unique
      - name: experience_required
        tests:
          - not_null
      - name: access_to_own_car
        tests:
          - not_null
      - name: driving_license_required
        tests:
          - not_null


  - name: dim_job_description 
    columns:
      - name: job_description_id
        tests:
          - not_null
          - unique
      - name: headline
        tests:
          - not_null
      - name: description_text
        tests:
          - not_null
      - name: description_html
        tests:
          - not_null

  - name: dim_job_details
    columns:
      - name: job_details_id
        tests:
          - not_null
          - unique
      - name: employment_type
        tests:
          - not_null
      - name: salary_type
        tests:
          - not_null
      - name: duration
        tests:
          - not_null
      - name: scope_of_work_max
        tests:
          - dbt_expectations.expect_column_max_to_be_between:
              min_value: 0
              max_value: 100
              config:
                severity: warn   
      - name: scope_of_work_min
        tests:
          - dbt_expectations.expect_column_max_to_be_between:
              min_value: 0
              max_value: 100
              config:
                severity: warn


